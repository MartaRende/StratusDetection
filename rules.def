Bootstrap: docker
From: nvidia/cuda:12.6.2-base-ubuntu22.04

%help
    This container provides a CUDA environment with Python and UV (Astral) for fast package installation.

%labels
    AUTHOR_NAME Marta Rende
    VERSION 1.0

%post -c /bin/bash
    export DEBIAN_FRONTEND=noninteractive

    # Install system dependencies
    apt-get -y update && apt-get -y install \
        git \
        python3-pip \
        python3-dev \
        python3-venv \
        python3-opencv \
        libglib2.0-0 \
        curl \
        build-essential

    # Install UV (Astral's fast Python installer)
    curl -LsSf https://astral.sh/uv/install.sh | sh
    export PATH="/root/.cargo/bin:$PATH"  # Add UV to PATH
    source $HOME/.local/bin/env
    # Initialize a virtual environment with UV (faster than venv)
    uv venv /opt/uv-venv
    export PATH="/opt/uv-venv/bin:$PATH"

    # Install packages with UV (much faster than pip)
    uv pip install --upgrade pip setuptools wheel
    uv pip install .

    # Make UV environment available by default
    echo 'export PATH="/opt/uv-venv/bin:$PATH"' >> /etc/bash.bashrc
    echo 'export PATH="/root/.cargo/bin:$PATH"' >> /etc/profile.d/uv.sh


%files
    pyproject.toml .
    training.py . 
%environment
    export PATH="/root/.cargo/bin:$PATH"
