Bootstrap: docker
From: nvidia/cuda:12.6.2-base-ubuntu22.04

%help
    This container provides a CUDA environment with Python and UV (Astral) for fast package installation.

%labels
    AUTHOR_NAME Marta Rende
    VERSION 1.0

%post -c /bin/bash
    export DEBIAN_FRONTEND=noninteractive

    # System dependencies
    apt-get -y update && apt-get -y install \
        git python3-pip python3-dev python3-venv \
        python3-opencv libglib2.0-0 curl build-essential \
        libgl1 libsm6 libxext6 libxrender-dev libopenblas-dev

    # Install UV
    curl -LsSf https://astral.sh/uv/install.sh | sh
    export PATH="/root/.cargo/bin:$PATH"
    source $HOME/.local/bin/env

    # Create venv
    uv venv /opt/uv-venv
    export PATH="/opt/uv-venv/bin:$PATH"

    # Install with verbose logging, no cache, and timeout
    uv pip install -v --no-cache-dir --timeout=120 --no-build-isolation .

    # Activate venv by default
    echo 'export PATH="/opt/uv-venv/bin:$PATH"' >> /etc/bash.bashrc

%files
    pyproject.toml .